<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Felon Friendlii Resources</title>
  <meta name="description" content="Resources and housing friendly to people with felony records." />
  <link rel="icon" href="images/ffr-logo.svg" type="image/svg+xml" />
  <link rel="stylesheet" href="css/styles.css" />
  <script defer src="js/main.js"></script>
</head>
<body>
  <header class="site-header">
    <div class="container nav">
      <button class="menu-toggle" aria-expanded="false" aria-controls="menu-panel" aria-label="Open menu">
        <span class="badge">F</span>
      </button>

      <a class="brand" href="./" aria-label="Felon Friendlii Resources Home">
        <img class="brand-logo" src="images/ffr-logo.svg" alt="Felon Friendlii Resources logo" />
      </a>
    </div>

    <nav id="menu-panel" class="menu-panel" hidden>
      <div class="container">
        <ul class="menu-list">
          <li><a href="./housing-search.html">Housing Search</a></li>
          <li><a href="./submit.html">Submit</a></li>
          <li><a href="./about.html">About</a></li>
        </ul>
      </div>
    </nav>
  </header>

  <main>
    <section class="hero hero--skyline">
      <div class="container hero-content">
        <div class="hero-top">
          <img class="hero-logo" src="images/ffr-logo.svg" alt="Felon Friendlii Resources logo" />
        </div>

        <h1 class="hero-title">Find resources that welcome your future</h1>

        <!-- City selector -->
        <div class="city-select" aria-label="Select city">
          <label for="city-select">City:</label>
          <select id="city-select" name="city">
            <option value="phx">Phoenix, AZ</option>
            <option value="tucson">Tucson, AZ</option>
            <option value="la">Los Angeles, CA</option>
            <option value="nyc">New York, NY</option>
            <option value="chi">Chicago, IL</option>
          </select>
        </div>

        <!-- Memos carousel -->
        <div class="memos-carousel" role="region" aria-label="Memos">
          <button class="memo-prev" aria-label="Previous memo" type="button" title="Previous">‚Äπ</button>
          <div class="memo-viewport" aria-live="polite">
            <div class="memo-slide"></div>
          </div>
          <button class="memo-next" aria-label="Next memo" type="button" title="Next">‚Ä∫</button>
        </div>

        <form class="search" action="resources.html" method="get">
          <input name="q" type="search" placeholder="Search all resources" aria-label="Search all resources" />
          <button type="submit">Search</button>
        </form>
      </div>

      <script>
        document.addEventListener('DOMContentLoaded', function () {
          // City config: skyline asset and memos slides per city.
          const CITY_DATA = {
            phx: {
              name: 'Phoenix, AZ',
              skyline: 'phoenix-skyline.jpg',
              memos: [
                'FELONS EAT FREE AT APPLEBEES UNTIL OCT 16 2025',
                'Oct 2, 2025: A bill passed to make expungement easier for non-violent felonies'
              ]
            },
            tucson: {
              name: 'Tucson, AZ',
              skyline: 'phoenix-skyline.jpg', // placeholder until tucson-specific image
              memos: [
                'Tucson: Local job fair for returning citizens this Saturday',
                'Tucson: Free legal clinic for expungement screening next week'
              ]
            },
            la: {
              name: 'Los Angeles, CA',
              skyline: 'phoenix-skyline.jpg', // placeholder
              memos: [
                'LA: Housing resource center expanded intake hours',
                'LA: Free transit passes for job interviews this month'
              ]
            },
            nyc: {
              name: 'New York, NY',
              skyline: 'phoenix-skyline.jpg', // placeholder
              memos: [
                'NYC: Record sealing workshop on Saturday',
                'NYC: New landlord incentives for fair-chance housing'
              ]
            },
            chi: {
              name: 'Chicago, IL',
              skyline: 'phoenix-skyline.jpg', // placeholder
              memos: [
                'Chicago: Training stipends available for apprenticeships',
                'Chicago: Fresh Start fair at Daley Center next week'
              ]
            }
          };

          const qs = new URL(window.location.href).searchParams;
          const stored = localStorage.getItem('ffr:city');
          let city = (qs.get('city') || stored || 'phx').toLowerCase();
          if (!CITY_DATA[city]) city = 'phx';

          const hero = document.querySelector('.hero--skyline');
          function applyCity(c) {
            const data = CITY_DATA[c] || CITY_DATA.phx;
            if (hero) {
              // Set path relative to the CSS file that consumes the var
              hero.style.setProperty('--skyline-image', "url('../images/" + data.skyline + "')");
            }
          }

          const viewport = document.querySelector('.memo-viewport');
          const prev = document.querySelector('.memo-prev');
          const next = document.querySelector('.memo-next');

          let index = 0;
          let timer = null;

          function renderMemo(c, i) {
            const data = CITY_DATA[c] || CITY_DATA.phx;
            const slides = data.memos && data.memos.length ? data.memos : CITY_DATA.phx.memos;
            const text = slides[i % slides.length];
            if (viewport) viewport.innerHTML = '<div class="memo-slide">' + text + '</div>';
          }

          function startTimer() {
            stopTimer();
            timer = setInterval(() => {
              const data = CITY_DATA[city] || CITY_DATA.phx;
              const len = (data.memos && data.memos.length) ? data.memos.length : CITY_DATA.phx.memos.length;
              index = (index + 1) % len;
              renderMemo(city, index);
            }, 10000);
          }

          function stopTimer() { if (timer) { clearInterval(timer); timer = null; } }

          function resetCarousel(c) { index = 0; renderMemo(c, index); startTimer(); }

          const sel = document.getElementById('city-select');
          if (sel) {
            sel.value = city;
            sel.addEventListener('change', () => {
              city = sel.value;
              localStorage.setItem('ffr:city', city);
              applyCity(city);
              resetCarousel(city);
            });
          }

          if (prev) prev.addEventListener('click', () => {
            const data = CITY_DATA[city] || CITY_DATA.phx;
            const len = (data.memos && data.memos.length) ? data.memos.length : CITY_DATA.phx.memos.length;
            index = (index - 1 + len) % len;
            renderMemo(city, index);
            startTimer();
          });

          if (next) next.addEventListener('click', () => {
            const data = CITY_DATA[city] || CITY_DATA.phx;
            const len = (data.memos && data.memos.length) ? data.memos.length : CITY_DATA.phx.memos.length;
            index = (index + 1) % len;
            renderMemo(city, index);
            startTimer();
          });

          if (viewport) {
            viewport.addEventListener('mouseenter', stopTimer);
            viewport.addEventListener('mouseleave', startTimer);
          }

          applyCity(city);
          resetCarousel(city);
        });
      </script>
    </section>

    <section class="container">
      <h2 class="section-title">Browse by category</h2>
      <div class="grid">
        <a class="tile" href="resources.html?cat=apartments" aria-label="Apartments">
          <div class="tile-emoji" aria-hidden>üè¢</div>
          <div class="tile-title">Apartments</div>
        </a>
        <a class="tile" href="resources.html?cat=halfway-houses" aria-label="Halfway Houses">
          <div class="tile-emoji" aria-hidden>üèöÔ∏è</div>
          <div class="tile-title">Halfway Houses</div>
        </a>
        <a class="tile" href="resources.html?cat=trades" aria-label="Trades">
          <div class="tile-emoji" aria-hidden>üõ†Ô∏è</div>
          <div class="tile-title">Trades</div>
        </a>
        <a class="tile" href="resources.html?cat=food" aria-label="Food">
          <div class="tile-emoji" aria-hidden>üçΩÔ∏è</div>
          <div class="tile-title">Food</div>
        </a>
        <a class="tile" href="resources.html?cat=clothes" aria-label="Clothes">
          <div class="tile-emoji" aria-hidden>üëï</div>
          <div class="tile-title">Clothes</div>
        </a>
        <a class="tile" href="housing-search.html" aria-label="Home Search">
          <div class="tile-emoji" aria-hidden>üîé</div>
          <div class="tile-title">Home Search</div>
        </a>
        <a class="tile" href="resources.html?tag=veteran" aria-label="Veteran">
          <div class="tile-emoji" aria-hidden>ü´∂</div>
          <div class="tile-title">Veteran</div>
        </a>
      </div>
    </section>
  </main>

  <footer class="site-footer">
    <div class="container">
      <p>&copy; <span id="year"></span> Felon Friendlii Resources</p>
    </div>
  </footer>
</body>
</html>